Başlık: API 401 (Unauthorized) - Port 5130 ve Cookie Gönderimi

Tarih: 2025-10-24

Özet:
- Sorun: `GET https://fatihdev.xyz:5130/api/user 401 (Unauthorized)` hatası.
- Neden: `fetch` isteklerinde `credentials: 'include'` eksikti; cookie gönderilmiyordu.
- Kurulum: API `https://fatihdev.xyz:5130` (HTTPS), WebSocket `wss://fatihdev.xyz:5131`.

Yapılan Düzeltmeler:
- `espfrontend/public/scripts/main.js` içinde aşağıdaki istekler `credentials: 'include'` ve `Content-Type: 'application/json'` ile güncellendi:
  - `GET /api/user` (hem `loadUserInfo`, hem `loadUserInfoAndAuth`)
  - `GET /api/security-key`
  - `GET /api/devices` (mevcuttu)
  - `GET /api/user/layout` (mevcuttu)
  - `POST /api/logout` (mevcuttu)

Sunucu Tarafı Notları:
- CORS `origin: ['https://fatihdev.xyz', ...]`, `credentials: true` olarak yapılandırılmış durumda.
- Cookie ayarları: `httpOnly: true`, `sameSite: 'lax'`, `path: '/'`.
- API, root yetkisi gerekmediği için 443 yerine 5130 portunda çalışıyor; TLS aktif.

Doğrulama Adımları:
1) Login ol → `Set-Cookie: sessionId=...` header'ını gör.
2) `GET https://fatihdev.xyz:5130/api/user` → 200 ve kullanıcı JSON'u dönmeli.
3) Konsolda `document.cookie` içinde `sessionId` görünüyor olmalı.

Not:
- `sameSite: 'lax'` aynı site (https://fatihdev.xyz ↔ https://fatihdev.xyz:5130) olduğundan cookie'ler isteklerle gönderilir.



