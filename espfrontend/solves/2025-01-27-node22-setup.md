# Node.js 22 Ortamı için Sunucu Yeniden Kurulumu

**Tarih:** 2025-01-27  
**Problem:** Node.js modülleri ile ilgili sorunlar ve Node 22 ortamı için yeniden düzenleme ihtiyacı  
**Çözüm:** Tüm bağımlılıklar Node 22 için güncellendi ve temiz kurulum yapıldı

## Yapılan Değişiklikler

### 1. package.json Güncellemeleri

- **Engine belirtildi:** Node 22 ve npm 10+ için engine kısıtlaması eklendi
- **better-sqlite3 güncellendi:** v9.2.2 → v11.8.1 (Node 22 uyumlu)
- Diğer paketler mevcut versiyonlarda kaldı (Node 22 ile uyumlu)

### 2. Kurulum Adımları

1. Eski `node_modules` ve `package-lock.json` temizlendi
2. Tüm bağımlılıklar yeniden kuruldu (`npm install`)
3. Native modül (better-sqlite3) Node 22 için derlendi

### 3. Kurulu Paketler

```
espfrontend@1.0.0
+-- better-sqlite3@11.10.0  (Node 22 uyumlu, native modül)
+-- cookie-parser@1.4.7
+-- cors@2.8.5
+-- express@5.1.0
+-- selfsigned@3.0.1 (dev)
`-- ws@8.18.3
```

### 4. Test Sonuçları

- ✅ better-sqlite3 Node 22 ile başarıyla yüklendi ve test edildi
- ✅ Tüm bağımlılıklar sorunsuz kuruldu
- ✅ Native modül derleme başarılı

## Gelecekte Yeniden Kurulum İçin

Eğer tekrar kurulum gerekiyorsa:

```bash
# 1. Eski modülleri temizle
Remove-Item -Recurse -Force node_modules
Remove-Item -Force package-lock.json

# 2. Yeniden kur
npm install

# 3. Test et
node -e "const db = require('better-sqlite3'); console.log('OK');"
```

## Notlar

- `better-sqlite3` native bir modül olduğu için her Node.js versiyonu değişikliğinde yeniden derlenmesi gerekir
- Node 22 ile Express 5.1.0, ws 8.18.3 ve diğer paketler uyumlu çalışıyor
- Engine kısıtlaması `package.json`'a eklendi, böylece yanlış Node versiyonu kullanıldığında uyarı verilir

## ⚠️ PRODUCTION DEPLOYMENT NOTU

**KRİTİK:** Native modül (`better-sqlite3`) platform/mimariye özel derlenir!

### ❌ YAPMAYIN:
- Windows'ta `npm install` yapıp `node_modules`'i Linux sunucusuna yüklemek
- Farklı işletim sistemleri arasında `node_modules` paylaşmak

### ✅ DOĞRU YÖNTEM:
1. `node_modules` ve `package-lock.json`'ı `.gitignore`'a ekle
2. Sadece kaynak kodları (ve `package.json`) sunucuya yükle
3. Sunucuda `npm install` çalıştır (native modül sunucuda derlenecek)

### Sunucuda Kurulum:
```bash
cd /path/to/project
rm -rf node_modules package-lock.json
npm install
pm2 restart app
```

### Hata Örneği:
```
Error: invalid file format (better_sqlite3.node)
ERR_DLOPEN_FAILED
```
Bu hata, native modülün yanlış platform için derlenmiş olduğunu gösterir.

